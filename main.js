!function(){"use strict";class e{constructor(e,t){var s,r,n;s=this,n=()=>this._inputElements.every((e=>e.validity.valid)),(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(r="_checkFormValidity"))in s?Object.defineProperty(s,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[r]=n,this._formElement=e,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_toggleButtonState(){this._checkFormValidity()?(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0)}_setEventListeners(){this._inputElements=[...this._formElement.querySelectorAll(this._inputSelector)],this._submitButton=this._formElement.querySelector(this._submitButtonSelector),this._inputElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputElements,this._submitButton)}))}))}resetValidation(){this._toggleButtonState(),this._inputElements.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners(this._formElement)}}class t{constructor(e){let{data:t,cardSelector:s,handlePreviewImage:r,handleLikeCard:n,currentUserId:i,handleDeleteCard:o,owner:a}=e;this._name=t.name,this._link=t.link,this._likes=t.likes,this._id=t._id,this._cardSelector=s,this._handleImageClick=r,this._handleLikeCard=n,this._currentUserId=i,this._owner=t.owner._id,this._handleDeleteCard=o,console.log(this._owner)}_getTemplate(){return document.querySelector(this._cardSelector).content.firstElementChild.cloneNode(!0)}deleteClick(){this._element.remove()}updateLikes(e){this._likes=e,this.renderLikes()}renderLikes(){this._cardLikes.textContent=this._likes.length,this.isLiked()?this.likeButton.classList.add("card__like-button_active"):this.likeButton.classList.remove("card__like-button_active")}isLiked(){return this._likes.some((e=>e._id===this._currentUserId))}_checkIdForDelete(){this._owner===this._currentUserId?this.addTrash():this.removeTrash()}addTrash(){this.cardTrashButton.classList.remove("card__trash-button_active")}removeTrash(){this.cardTrashButton.classList.add("card__trash-button_active")}_setEventListeners(){this.likeButton.addEventListener("click",(()=>this._handleLikeCard(this.isLiked()))),this.cardTrashButton.addEventListener("click",(()=>{this._handleDeleteCard(this._id)})),this.cardImage.addEventListener("click",(()=>{this._handleImageClick()}))}generateCard(){this._element=this._getTemplate(),this.likeButton=this._element.querySelector(".card__like-button"),this.cardTrashButton=this._element.querySelector(".card__trash-button"),this.cardImage=this._element.querySelector(".card__image");const e=this._element.querySelector(".card__title");return this.cardImage.src=this._link,this.cardImage.alt=this._name,e.textContent=this._name,this._cardLikes=this._element.querySelector(".card__likes-counter"),this.renderLikes(),this._setEventListeners(),this._checkIdForDelete(),this._element}}class s{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__closebutton"))&&this.close()}))}}var r=class extends s{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".popup__form"),this._handleFormSubmit=t,this._modalSaveButton=this._popupElement.querySelector(".popup__button"),this._saveButtonText=this._modalSaveButton.textContent}_getInputValue(){const e=this._popupForm.querySelectorAll(".popup__input"),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(()=>this._handleFormSubmit(this._getInputValue())))}renderLoading(e){this._modalSaveButton.textContent=e?"Saving...":this._saveButtonText}close(){this._popupForm.reset(),super.close()}};class n{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector("#modal"),o=document.querySelector(".profile__edit-button"),a=(i.querySelector("#modal-closebutton"),i.querySelector("#modal-form")),l=document.querySelector("#popup-name"),c=document.querySelector("#popup-description"),d=document.querySelector("#add-popup"),h=document.querySelector(".profile__add-button");console.log(d);const u=d.querySelector("#add-popupform"),_=(document.querySelector("#preview-popup").querySelector("#popup-closebutton"),document.querySelector("#avi-popupform")),p={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},m=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:r}=e;this._nameEl=document.querySelector(t),this._jobEl=document.querySelector(s),this._avatarElement=document.querySelector(r)}getUserInfo(){return{name:this._nameEl.textContent,job:this._jobEl.textContent,avatar:this._avatarELement}}setAvatarInfo(e){this._avatarElement.src=e}setUserInfo(e){let{name:t,job:s}=e;this._nameEl.textContent=t,this._jobEl.textContent=s}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"}),v=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}getAppInfo(){return Promise.all([this.getUserInfo(),this.initialCards()])}initialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then(this._checkResponse)}editProfile(e){let{name:t,description:s}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then(this._checkResponse)}addNewCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}/cards`,{method:"post",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then(this._checkResponse)}cardLikes(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){let{_id:t}=e;return fetch(`${this._baseUrl}/cards/likes/${t}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){let{_id:t}=e;return fetch(`${this._baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateProfilePicture(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"192a5b57-9b62-4192-96d6-217d99b33573","Content-Type":"application/json"}});let E,b;function S(e){const s=new t({data:e,cardSelector:"#card-template",currentUserId:b,handlePreviewImage:()=>{q.open(e)},handleLikeCard:t=>{t?v.removeLike(e).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)})):v.addLike(e).then((e=>{s.updateLikes(e.likes)})).catch((e=>{console.log(e)}))},handleDeleteCard:e=>{g.open(),g.setSubmitAction((()=>{g.renderLoading(!0),v.deleteCard(e).then((()=>{s.deleteClick(),g.close()})).catch((e=>{console.log(e)})).finally((()=>{g.renderLoading(!1)}))}))}});return s.generateCard()}v.getAppInfo().then((e=>{let[t,s]=e;b=t._id,m.setUserInfo({name:t.name,job:t.about}),m.setAvatarInfo(t.avatar),E=new n({items:s,renderer:e=>{const t=S(e);E.addItem(t)}},".cards__list"),E.renderItems()})).catch((e=>{console.log(e)}));const k=new e(u,p);k.enableValidation(),console.log(u);const L=new e(a,p);L.enableValidation();const f=new e(_,p);f.enableValidation();const g=new class extends s{constructor(e){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".popup__form"),this._confirmButton=document.querySelector("#delete__button"),this._saveButton=document.querySelector(".popup__button")}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleDeleteSubmit()}))}renderLoading(e){this._confirmButton.textContent=e?"Saving...":"yes"}setSubmitAction(e){this._handleDeleteSubmit=e}}("#delete-popup");g.setEventListeners();const y=new r("#modal",(e=>{y.renderLoading(!0),v.editProfile(e).then((()=>{m.setUserInfo({name:e.name,job:e.description}),y.close()})).catch((e=>{console.log(e)})).finally((()=>{y.renderLoading(!1)}))}));y.setEventListeners();const C=new r("#add-popup",(e=>{C.renderLoading(!0),v.addNewCard(e).then((e=>{const t=S(e);E.addItem(t),C.close()})).catch((e=>{console.log(e)})).finally((()=>{C.renderLoading(!1)}))}));C.setEventListeners();const I=new r("#avi-popup",(e=>{I.renderLoading(!0),v.updateProfilePicture(e).then((e=>{m.setAvatarInfo(e.avatar),I.close()})).catch((e=>{console.log(e)})).finally((()=>{I.renderLoading(!1)}))}));I.setEventListeners(),document.querySelector(".profile__image").addEventListener("click",(()=>{I.open(),f.resetValidation()}));const q=new class extends s{constructor(e){super({popupSelector:e}),this._image=document.querySelector("#popup-image"),this._text=document.querySelector("#popup-text")}open(e){let{link:t,name:s}=e;this._image.src=t,this._image.alt=s,this._text.textContent=s,super.open()}}("#preview-popup");q.setEventListeners(),o.addEventListener("click",(function(){const{name:e,job:t}=m.getUserInfo();l.value=e,c.value=t,L.resetValidation(),y.open()})),h.addEventListener("click",(()=>{k.resetValidation(),C.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQWUsTUFBTUEsRUFDbkJDLFlBQVlDLEVBQWFDLEcsWUFBUSxLLEVBbUNaLElBQ25CQyxLQUFLQyxlQUFlQyxPQUFPQyxHQUFVQSxFQUFNQyxTQUFTQyxTLCtTQXBDckIseUIsd0ZBQy9CTCxLQUFLTSxhQUFlUixFQUNwQkUsS0FBS08sZUFBaUJSLEVBQU9TLGNBQzdCUixLQUFLUyxzQkFBd0JWLEVBQU9XLHFCQUNwQ1YsS0FBS1cscUJBQXVCWixFQUFPYSxvQkFDbkNaLEtBQUthLGlCQUFtQmQsRUFBT2UsZ0JBQy9CZCxLQUFLZSxZQUFjaEIsRUFBT2lCLFVBQzVCLENBRUFDLGdCQUFnQkMsR0FDZCxNQUFNQyxFQUFzQm5CLEtBQUtNLGFBQWFjLGNBQzNDLElBQUdGLEVBQWFHLFlBRW5CSCxFQUFhSSxVQUFVQyxJQUFJdkIsS0FBS2Esa0JBQ2hDTSxFQUFvQkssWUFBY04sRUFBYU8sa0JBQy9DTixFQUFvQkcsVUFBVUMsSUFBSXZCLEtBQUtlLFlBQ3pDLENBRUFXLGdCQUFnQlIsR0FDZCxNQUFNQyxFQUFzQm5CLEtBQUtNLGFBQWFjLGNBQzNDLElBQUdGLEVBQWFHLFlBRW5CSCxFQUFhSSxVQUFVSyxPQUFPM0IsS0FBS2Esa0JBQ25DTSxFQUFvQkssWUFBYyxHQUNsQ0wsRUFBb0JHLFVBQVVLLE9BQU8zQixLQUFLZSxZQUM1QyxDQUVBYSxvQkFBb0JWLEdBQ2JBLEVBQWFkLFNBQVNDLE1BR3pCTCxLQUFLMEIsZ0JBQWdCUixHQUZyQmxCLEtBQUtpQixnQkFBZ0JDLEVBSXpCLENBS0FXLHFCQUNnQjdCLEtBQUs4QixzQkFFakI5QixLQUFLK0IsY0FBY1QsVUFBVUssT0FBTzNCLEtBQUtXLHNCQUN6Q1gsS0FBSytCLGNBQWNDLFVBQVcsSUFFOUJoQyxLQUFLK0IsY0FBY1QsVUFBVUMsSUFBSXZCLEtBQUtXLHNCQUN0Q1gsS0FBSytCLGNBQWNDLFVBQVcsRUFjbEMsQ0FFQUMscUJBQ0VqQyxLQUFLQyxlQUFpQixJQUNqQkQsS0FBS00sYUFBYTRCLGlCQUFpQmxDLEtBQUtPLGlCQUU3Q1AsS0FBSytCLGNBQWdCL0IsS0FBS00sYUFBYWMsY0FDckNwQixLQUFLUyx1QkFFUFQsS0FBS0MsZUFBZWtDLFNBQVNqQixJQUMzQkEsRUFBYWtCLGlCQUFpQixTQUFTLEtBQ3JDcEMsS0FBSzRCLG9CQUFvQlYsR0FDekJsQixLQUFLNkIsbUJBQW1CN0IsS0FBS0MsZUFBZ0JELEtBQUsrQixjQUFjLEdBQ2hFLEdBRU4sQ0FFQU0sa0JBQ0VyQyxLQUFLNkIscUJBQ0w3QixLQUFLQyxlQUFla0MsU0FBU2pCLElBQzNCbEIsS0FBSzBCLGdCQUFnQlIsRUFBYSxHQUV0QyxDQUVBb0IsbUJBQ0V0QyxLQUFLTSxhQUFhOEIsaUJBQWlCLFVBQVdHLElBQzVDQSxFQUFJQyxnQkFBZ0IsSUFFdEJ4QyxLQUFLaUMsbUJBQW1CakMsS0FBS00sYUFDL0IsRUN6RmEsTUFBTW1DLEVBQ25CNUMsWUFBVzZDLEdBUVIsSUFSUyxLQUNWQyxFQUFJLGFBQ0pDLEVBQVksbUJBQ1pDLEVBQWtCLGVBQ2xCQyxFQUFjLGNBQ2RDLEVBQWEsaUJBQ2JDLEVBQWdCLE1BQ2hCQyxHQUNEUCxFQUNDMUMsS0FBS2tELE1BQVFQLEVBQUtRLEtBQ2xCbkQsS0FBS29ELE1BQVFULEVBQUtVLEtBQ2xCckQsS0FBS3NELE9BQVNYLEVBQUtZLE1BQ25CdkQsS0FBS3dELElBQU1iLEVBQUthLElBRWhCeEQsS0FBS3lELGNBQWdCYixFQUNyQjVDLEtBQUswRCxrQkFBb0JiLEVBQ3pCN0MsS0FBSzJELGdCQUFrQmIsRUFDdkI5QyxLQUFLNEQsZUFBaUJiLEVBQ3RCL0MsS0FBSzZELE9BQVNsQixFQUFLTSxNQUFNTyxJQUN6QnhELEtBQUs4RCxrQkFBb0JkLEVBQ3pCZSxRQUFRQyxJQUFJaEUsS0FBSzZELE9BQ25CLENBRUFJLGVBSUUsT0FIb0JDLFNBQ2pCOUMsY0FBY3BCLEtBQUt5RCxlQUNuQlUsUUFBUUMsa0JBQWtCQyxXQUFVLEVBRXpDLENBRUFDLGNBQ0V0RSxLQUFLdUUsU0FBUzVDLFFBQ2hCLENBRUE2QyxZQUFZakIsR0FDVnZELEtBQUtzRCxPQUFTQyxFQUNkdkQsS0FBS3lFLGFBQ1AsQ0FFQUEsY0FDRXpFLEtBQUswRSxXQUFXbEQsWUFBY3hCLEtBQUtzRCxPQUFPcUIsT0FDMUIzRSxLQUFLNEUsVUFFbkI1RSxLQUFLNkUsV0FBV3ZELFVBQVVDLElBQUksNEJBRTlCdkIsS0FBSzZFLFdBQVd2RCxVQUFVSyxPQUFPLDJCQUVyQyxDQUVBaUQsVUFDRSxPQUFPNUUsS0FBS3NELE9BQU93QixNQUFNQyxHQUFTQSxFQUFLdkIsTUFBUXhELEtBQUs0RCxnQkFDdEQsQ0FFQW9CLG9CQUNNaEYsS0FBSzZELFNBQVc3RCxLQUFLNEQsZUFDdkI1RCxLQUFLaUYsV0FFTGpGLEtBQUtrRixhQUVULENBRUFELFdBQ0VqRixLQUFLbUYsZ0JBQWdCN0QsVUFBVUssT0FBTyw0QkFDeEMsQ0FFQXVELGNBQ0VsRixLQUFLbUYsZ0JBQWdCN0QsVUFBVUMsSUFBSSw0QkFDckMsQ0FFQVUscUJBQ0VqQyxLQUFLNkUsV0FBV3pDLGlCQUFpQixTQUFTLElBQ3hDcEMsS0FBSzJELGdCQUFnQjNELEtBQUs0RSxhQUU1QjVFLEtBQUttRixnQkFBZ0IvQyxpQkFBaUIsU0FBUyxLQUM3Q3BDLEtBQUs4RCxrQkFBa0I5RCxLQUFLd0QsSUFBSSxJQUVsQ3hELEtBQUtvRixVQUFVaEQsaUJBQWlCLFNBQVMsS0FDdkNwQyxLQUFLMEQsbUJBQW1CLEdBRTVCLENBRUEyQixlQUNFckYsS0FBS3VFLFNBQVd2RSxLQUFLaUUsZUFDckJqRSxLQUFLNkUsV0FBYTdFLEtBQUt1RSxTQUFTbkQsY0FBYyxzQkFDOUNwQixLQUFLbUYsZ0JBQWtCbkYsS0FBS3VFLFNBQVNuRCxjQUFjLHVCQUNuRHBCLEtBQUtvRixVQUFZcEYsS0FBS3VFLFNBQVNuRCxjQUFjLGdCQUM3QyxNQUFNa0UsRUFBWXRGLEtBQUt1RSxTQUFTbkQsY0FBYyxnQkFROUMsT0FQQXBCLEtBQUtvRixVQUFVRyxJQUFNdkYsS0FBS29ELE1BQzFCcEQsS0FBS29GLFVBQVVJLElBQU14RixLQUFLa0QsTUFDMUJvQyxFQUFVOUQsWUFBY3hCLEtBQUtrRCxNQUM3QmxELEtBQUswRSxXQUFhMUUsS0FBS3VFLFNBQVNuRCxjQUFjLHdCQUM5Q3BCLEtBQUt5RSxjQUNMekUsS0FBS2lDLHFCQUNMakMsS0FBS2dGLG9CQUNFaEYsS0FBS3VFLFFBQ2QsRUNoR2EsTUFBTWtCLEVBQ25CNUYsWUFBVzZDLEdBQW9CLElBQW5CLGNBQUVnRCxHQUFlaEQsRUFDM0IxQyxLQUFLMkYsY0FBZ0J6QixTQUFTOUMsY0FBY3NFLEdBQzVDMUYsS0FBSzRGLGdCQUFrQjVGLEtBQUs0RixnQkFBZ0JDLEtBQUs3RixLQUNuRCxDQUVBOEYsT0FDRTlGLEtBQUsyRixjQUFjckUsVUFBVUMsSUFBSSxnQkFDakMyQyxTQUFTOUIsaUJBQWlCLFVBQVdwQyxLQUFLNEYsZ0JBQzVDLENBRUFHLFFBQ0UvRixLQUFLMkYsY0FBY3JFLFVBQVVLLE9BQU8sZ0JBQ3BDdUMsU0FBUzhCLG9CQUFvQixVQUFXaEcsS0FBSzRGLGdCQUMvQyxDQUVBQSxnQkFBZ0JyRCxHQUNFLFdBQVpBLEVBQUkwRCxLQUNOakcsS0FBSytGLE9BRVQsQ0FFQUcsb0JBQ0VsRyxLQUFLMkYsY0FBY3ZELGlCQUFpQixhQUFjRyxLQUU5Q0EsRUFBSTRELE9BQU83RSxVQUFVOEUsU0FBUyxVQUM5QjdELEVBQUk0RCxPQUFPN0UsVUFBVThFLFNBQVMsd0JBRTlCcEcsS0FBSytGLE9BQ1AsR0FFSixFQ1NGLE1BdkNBLGNBQTRCTixFQUMxQjVGLFlBQVk2RixFQUFlVyxHQUN6QkMsTUFBTSxDQUFFWixrQkFDUjFGLEtBQUt1RyxXQUFhdkcsS0FBSzJGLGNBQWN2RSxjQUFjLGdCQUNuRHBCLEtBQUt3RyxrQkFBb0JILEVBQ3pCckcsS0FBS3lHLGlCQUFtQnpHLEtBQUsyRixjQUFjdkUsY0FBYyxrQkFDekRwQixLQUFLMEcsZ0JBQWtCMUcsS0FBS3lHLGlCQUFpQmpGLFdBQy9DLENBRUFtRixpQkFDRSxNQUFNQyxFQUFTNUcsS0FBS3VHLFdBQVdyRSxpQkFBaUIsaUJBQzFDMkUsRUFBYyxDQUFDLEVBSXJCLE9BSEFELEVBQU96RSxTQUFTaEMsSUFDZDBHLEVBQVkxRyxFQUFNZ0QsTUFBUWhELEVBQU0yRyxLQUFLLElBRWhDRCxDQUNULENBRUFYLG9CQUNFSSxNQUFNSixvQkFDTmxHLEtBQUt1RyxXQUFXbkUsaUJBQWlCLFVBQVUsSUFDekNwQyxLQUFLd0csa0JBQWtCeEcsS0FBSzJHLG1CQUVoQyxDQUVBSSxjQUFjQyxHQUVWaEgsS0FBS3lHLGlCQUFpQmpGLFlBRHBCd0YsRUFDa0MsWUFFQWhILEtBQUswRyxlQUU3QyxDQUVBWCxRQUNFL0YsS0FBS3VHLFdBQVdVLFFBQ2hCWCxNQUFNUCxPQUNSLEdDckNhLE1BQU1tQixFQUNuQnJILFlBQVc2QyxFQUFzQnlFLEdBQVUsSUFBL0IsTUFBRUMsRUFBSyxTQUFFQyxHQUFVM0UsRUFDN0IxQyxLQUFLc0gsT0FBU0YsRUFDZHBILEtBQUt1SCxVQUFZRixFQUNqQnJILEtBQUt3SCxXQUFhdEQsU0FBUzlDLGNBQWMrRixFQUMzQyxDQUVBTSxjQUNFekgsS0FBS3NILE9BQU9uRixTQUFTdUYsSUFDbkIxSCxLQUFLdUgsVUFBVUcsRUFBSyxHQUV4QixDQUVBQyxRQUFRQyxHQUNONUgsS0FBS3dILFdBQVdLLFFBQVFELEVBQzFCLEVDZkYsTUEyQk1FLEVBQWtCNUQsU0FBUzlDLGNBQWMsVUFDekMyRyxFQUFvQjdELFNBQVM5QyxjQUFjLHlCQUczQzRHLEdBREpGLEVBQWdCMUcsY0FBYyxzQkFDUjBHLEVBQWdCMUcsY0FBYyxnQkFDaEQ2RyxFQUFvQi9ELFNBQVM5QyxjQUFjLGVBQzNDOEcsRUFBMEJoRSxTQUFTOUMsY0FBYyxzQkFDakQrRyxFQUFjakUsU0FBUzlDLGNBQWMsY0FDckNnSCxFQUFpQmxFLFNBQVM5QyxjQUFjLHdCQUM5QzJDLFFBQVFDLElBQUltRSxHQUNaLE1BQU1FLEVBQWVGLEVBQVkvRyxjQUFjLGtCQUd6Q2tILEdBRm1CcEUsU0FBUzlDLGNBQWMsa0JBQ05BLGNBQWMsc0JBQ3hDOEMsU0FBUzlDLGNBQWMsbUJBRWpDbUgsRUFBdUIsQ0FDM0IvSCxjQUFlLGdCQUNmRSxxQkFBc0IsaUJBQ3RCRSxvQkFBcUIseUJBQ3JCRSxnQkFBaUIsMEJBQ2pCRSxXQUFZLHdCQ3JCUndILEVBQWEsSUMxQkosTUFDYjNJLFlBQVc2QyxHQUFnRCxJQUEvQyxhQUFFK0YsRUFBWSxZQUFFQyxFQUFXLGVBQUVDLEdBQWdCakcsRUFDdkQxQyxLQUFLNEksUUFBVTFFLFNBQVM5QyxjQUFjcUgsR0FDdEN6SSxLQUFLNkksT0FBUzNFLFNBQVM5QyxjQUFjc0gsR0FDckMxSSxLQUFLOEksZUFBaUI1RSxTQUFTOUMsY0FBY3VILEVBQy9DLENBRUFJLGNBQ0UsTUFBTyxDQUNMNUYsS0FBTW5ELEtBQUs0SSxRQUFRcEgsWUFDbkJ3SCxJQUFLaEosS0FBSzZJLE9BQU9ySCxZQUNqQnlILE9BQVFqSixLQUFLa0osZUFFakIsQ0FFQUMsY0FBY0YsR0FDWmpKLEtBQUs4SSxlQUFldkQsSUFBTTBELENBQzVCLENBRUFHLFlBQVdDLEdBQWdCLElBQWYsS0FBRWxHLEVBQUksSUFBRTZGLEdBQUtLLEVBQ3ZCckosS0FBSzRJLFFBQVFwSCxZQUFjMkIsRUFDM0JuRCxLQUFLNkksT0FBT3JILFlBQWN3SCxDQUM1QixHREk4QixDQUM5QlAsYUFBYyxrQkFDZEMsWUFBYSx3QkFDYkMsZUFBZ0Isb0JBSVpXLEVBQU0sSUVqQ0csTUFDYnpKLFlBQVc2QyxHQUF1QixJQUF0QixRQUFFNkcsRUFBTyxRQUFFQyxHQUFTOUcsRUFDOUIxQyxLQUFLeUosU0FBV0YsRUFDaEJ2SixLQUFLMEosU0FBV0YsQ0FDbEIsQ0FFQUcsZUFBZUMsR0FDYixPQUFJQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUVOQyxRQUFRQyxPQUFRLFNBQVFKLEVBQUlLLFNBQ3JDLENBRUFsQixjQUNFLE9BQU9tQixNQUFPLEdBQUVsSyxLQUFLeUosb0JBQXFCLENBQ3hDVSxPQUFRLE1BQ1JYLFFBQVN4SixLQUFLMEosV0FDYlUsS0FBS3BLLEtBQUsySixlQUNmLENBRUFVLGFBQ0UsT0FBT04sUUFBUU8sSUFBSSxDQUFDdEssS0FBSytJLGNBQWUvSSxLQUFLdUssZ0JBQy9DLENBRUFBLGVBQ0UsT0FBT0wsTUFBTyxHQUFFbEssS0FBS3lKLGlCQUFrQixDQUNyQ1UsT0FBUSxNQUNSWCxRQUFTeEosS0FBSzBKLFdBQ2JVLEtBQUtwSyxLQUFLMkosZUFDZixDQUVBYSxZQUFXbkIsR0FBd0IsSUFBdkIsS0FBRWxHLEVBQUksWUFBRXNILEdBQWFwQixFQUMvQixPQUFPYSxNQUFPLEdBQUVsSyxLQUFLeUosb0JBQXFCLENBQ3hDVSxPQUFRLFFBQ1JYLFFBQVN4SixLQUFLMEosU0FDZGdCLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJ6SCxLQUFNQSxFQUNOMEgsTUFBT0osTUFFUkwsS0FBS3BLLEtBQUsySixlQUNmLENBRUFtQixXQUFVQyxHQUFpQixJQUFoQixLQUFFNUgsRUFBSSxLQUFFRSxHQUFNMEgsRUFDdkIsT0FBT2IsTUFBTyxHQUFFbEssS0FBS3lKLGlCQUFrQixDQUNyQ1UsT0FBUSxPQUNSWCxRQUFTeEosS0FBSzBKLFNBQ2RnQixLQUFNQyxLQUFLQyxVQUFVLENBQ25CekgsT0FDQUUsV0FFRCtHLEtBQUtwSyxLQUFLMkosZUFDZixDQUVBcUIsVUFBVUMsR0FDUixPQUFPZixNQUFPLEdBQUVsSyxLQUFLeUosd0JBQXdCd0IsSUFBVSxDQUNyRGQsT0FBUSxNQUNSWCxRQUFTeEosS0FBSzBKLFdBQ2JVLEtBQUtwSyxLQUFLMkosZUFDZixDQUVBdUIsV0FBV0MsR0FDVCxPQUFPakIsTUFBTyxHQUFFbEssS0FBS3lKLGtCQUFrQjBCLElBQVUsQ0FDL0NoQixPQUFRLFNBQ1JYLFFBQVN4SixLQUFLMEosV0FDYlUsS0FBS3BLLEtBQUsySixlQUNmLENBRUF5QixRQUFPQyxHQUFVLElBQVQsSUFBRTdILEdBQUs2SCxFQUNiLE9BQU9uQixNQUFPLEdBQUVsSyxLQUFLeUosd0JBQXdCakcsSUFBTyxDQUNsRDJHLE9BQVEsTUFDUlgsUUFBU3hKLEtBQUswSixXQUNiVSxLQUFLcEssS0FBSzJKLGVBQ2YsQ0FFQTJCLFdBQVVDLEdBQVUsSUFBVCxJQUFFL0gsR0FBSytILEVBQ2hCLE9BQU9yQixNQUFPLEdBQUVsSyxLQUFLeUosd0JBQXdCakcsSUFBTyxDQUNsRDJHLE9BQVEsU0FDUlgsUUFBU3hKLEtBQUswSixXQUNiVSxLQUFLcEssS0FBSzJKLGVBQ2YsQ0FFQTZCLHFCQUFxQnZDLEdBQ25CLE9BQU9pQixNQUFPLEdBQUVsSyxLQUFLeUosMkJBQTRCLENBQy9DVSxPQUFRLFFBQ1JYLFFBQVN4SixLQUFLMEosU0FDZGdCLEtBQU1DLEtBQUtDLFVBQVUzQixLQUNwQm1CLEtBQUtwSyxLQUFLMkosZUFDZixHRnREa0IsQ0FDbEJKLFFBQVMsOENBQ1RDLFFBQVMsQ0FDUGlDLGNBQWUsdUNBQ2YsZUFBZ0Isc0JBR3BCLElBQUlDLEVBQ0EzSSxFQXlCSixTQUFTNEksRUFBV2hKLEdBQ2xCLE1BQU1pSixFQUFPLElBQUluSixFQUFLLENBQ3BCRSxPQUNBQyxhQUFjLGlCQUNkRyxnQkFDQUYsbUJBQW9CQSxLQUNsQmdKLEVBQVcvRixLQUFLbkQsRUFBSyxFQUV2QkcsZUFBaUJnSixJQUNYQSxFQUNGeEMsRUFDR2dDLFdBQVczSSxHQUNYeUgsTUFBTXpILElBQ0xpSixFQUFLcEgsWUFBWTdCLEVBQUtZLE1BQU0sSUFFN0J3SSxPQUFPQyxJQUNOakksUUFBUUMsSUFBSWdJLEVBQUksSUFHcEIxQyxFQUNHOEIsUUFBUXpJLEdBQ1J5SCxNQUFNekgsSUFDTGlKLEVBQUtwSCxZQUFZN0IsRUFBS1ksTUFBTSxJQUU3QndJLE9BQU9DLElBQ05qSSxRQUFRQyxJQUFJZ0ksRUFBSSxHQUV0QixFQUVGaEosaUJBQW1CaUksSUFDakJnQixFQUFZbkcsT0FDWm1HLEVBQVlDLGlCQUFnQixLQUMxQkQsRUFBWWxGLGVBQWMsR0FDMUJ1QyxFQUNHNEIsV0FBV0QsR0FDWGIsTUFBSyxLQUNKd0IsRUFBS3RILGNBQ0wySCxFQUFZbEcsT0FBTyxJQUVwQmdHLE9BQU9DLElBQ05qSSxRQUFRQyxJQUFJZ0ksRUFBSSxJQUVqQkcsU0FBUSxLQUNQRixFQUFZbEYsZUFBYyxFQUFNLEdBQ2hDLEdBQ0osSUFHTixPQUFPNkUsRUFBS3ZHLGNBQ2QsQ0F6RUFpRSxFQUNHZSxhQUNBRCxNQUFLMUgsSUFBMEIsSUFBeEIwSixFQUFVQyxHQUFTM0osRUFDekJLLEVBQWdCcUosRUFBUzVJLElBQ3pCZ0YsRUFBV1ksWUFBWSxDQUFFakcsS0FBTWlKLEVBQVNqSixLQUFNNkYsSUFBS29ELEVBQVN2QixRQUM1RHJDLEVBQVdXLGNBQWNpRCxFQUFTbkQsUUFFbEN5QyxFQUFZLElBQUl4RSxFQUNkLENBQ0VFLE1BQU9pRixFQUVQaEYsU0FBVzFFLElBQ1QsTUFBTWlKLEVBQU9ELEVBQVdoSixHQUN4QitJLEVBQVUvRCxRQUFRaUUsRUFBSyxHQUczQixnQkFFRkYsRUFBVWpFLGFBQWEsSUFFeEJzRSxPQUFPQyxJQUNOakksUUFBUUMsSUFBSWdJLEVBQUksSUFzRHBCLE1BQU1NLEVBQW1CLElBQUkxTSxFQUFjeUksRUFBY0UsR0FDekQrRCxFQUFpQmhLLG1CQUNqQnlCLFFBQVFDLElBQUlxRSxHQUVaLE1BQU1rRSxFQUF1QixJQUFJM00sRUFDL0JvSSxFQUNBTyxHQUVGZ0UsRUFBcUJqSyxtQkFFckIsTUFBTWtLLEVBQW1CLElBQUk1TSxFQUFjMEksRUFBU0MsR0FDcERpRSxFQUFpQmxLLG1CQUVqQixNQUFNMkosRUFBYyxJR2hJTCxjQUFvQ3hHLEVBQ2pENUYsWUFBWTZGLEdBQ1ZZLE1BQU0sQ0FBRVosa0JBQ1IxRixLQUFLdUcsV0FBYXZHLEtBQUsyRixjQUFjdkUsY0FBYyxnQkFDbkRwQixLQUFLeU0sZUFBaUJ2SSxTQUFTOUMsY0FBYyxtQkFDN0NwQixLQUFLME0sWUFBY3hJLFNBQVM5QyxjQUFjLGlCQUM1QyxDQUVBOEUsb0JBQ0VJLE1BQU1KLG9CQUNObEcsS0FBS3VHLFdBQVduRSxpQkFBaUIsVUFBV0csSUFDMUNBLEVBQUlDLGlCQUNKeEMsS0FBSzJNLHFCQUFxQixHQUU5QixDQUNBNUYsY0FBY0MsR0FFVmhILEtBQUt5TSxlQUFlakwsWUFEbEJ3RixFQUNnQyxZQUVBLEtBRXRDLENBRUFrRixnQkFBZ0JVLEdBQ2Q1TSxLQUFLMk0sb0JBQXNCQyxDQUM3QixHSHVHNEMsaUJBQzlDWCxFQUFZL0Ysb0JBRVosTUFBTTJHLEVBQWdCLElBQUlDLEVBQWMsVUFBV2pHLElBQ2pEZ0csRUFBYzlGLGVBQWMsR0FDNUJ1QyxFQUNHa0IsWUFBWTNELEdBQ1p1RCxNQUFLLEtBQ0o1QixFQUFXWSxZQUFZLENBQ3JCakcsS0FBTTBELEVBQVkxRCxLQUNsQjZGLElBQUtuQyxFQUFZNEQsY0FFbkJvQyxFQUFjOUcsT0FBTyxJQUV0QmdHLE9BQU9DLElBQ05qSSxRQUFRQyxJQUFJZ0ksRUFBSSxJQUVqQkcsU0FBUSxLQUNQVSxFQUFjOUYsZUFBYyxFQUFNLEdBQ2xDLElBRU44RixFQUFjM0csb0JBRWQsTUFBTTZHLEVBQWUsSUFBSUQsRUFBYyxjQUFlakcsSUFDcERrRyxFQUFhaEcsZUFBYyxHQUMzQnVDLEVBQ0d3QixXQUFXakUsR0FDWHVELE1BQU16SCxJQUNMLE1BQU1pSixFQUFPRCxFQUFXaEosR0FDeEIrSSxFQUFVL0QsUUFBUWlFLEdBQ2xCbUIsRUFBYWhILE9BQU8sSUFFckJnRyxPQUFPQyxJQUNOakksUUFBUUMsSUFBSWdJLEVBQUksSUFFakJHLFNBQVEsS0FDUFksRUFBYWhHLGVBQWMsRUFBTSxHQUNqQyxJQUVOZ0csRUFBYTdHLG9CQUViLE1BQU04RyxFQUFvQixJQUFJRixFQUFjLGNBQWVqRyxJQUN6RG1HLEVBQWtCakcsZUFBYyxHQUNoQ3VDLEVBQ0drQyxxQkFBcUIzRSxHQUNyQnVELE1BQU10RCxJQUNMMEIsRUFBV1csY0FBY3JDLEVBQU1tQyxRQUMvQitELEVBQWtCakgsT0FBTyxJQUUxQmdHLE9BQU9DLElBQ05qSSxRQUFRQyxJQUFJZ0ksRUFBSSxJQUVqQkcsU0FBUSxLQUNQYSxFQUFrQmpHLGVBQWMsRUFBTSxHQUN0QyxJQUVOaUcsRUFBa0I5RyxvQkFFRWhDLFNBQVM5QyxjQUFjLG1CQUMvQmdCLGlCQUFpQixTQUFTLEtBQ3BDNEssRUFBa0JsSCxPQUNsQjBHLEVBQWlCbkssaUJBQWlCLElBR3BDLE1BQU13SixFQUFhLElJaE1KLGNBQTZCcEcsRUFDMUM1RixZQUFZNkYsR0FDVlksTUFBTSxDQUFFWixrQkFDUjFGLEtBQUtpTixPQUFTL0ksU0FBUzlDLGNBQWMsZ0JBQ3JDcEIsS0FBS2tOLE1BQVFoSixTQUFTOUMsY0FBYyxjQUN0QyxDQUVBMEUsS0FBSXBELEdBQWlCLElBQWhCLEtBQUVXLEVBQUksS0FBRUYsR0FBTVQsRUFDakIxQyxLQUFLaU4sT0FBTzFILElBQU1sQyxFQUNsQnJELEtBQUtpTixPQUFPekgsSUFBTXJDLEVBQ2xCbkQsS0FBS2tOLE1BQU0xTCxZQUFjMkIsRUFDekJtRCxNQUFNUixNQUNSLEdKb0xvQyxrQkFDdEMrRixFQUFXM0Ysb0JBU1g2QixFQUFrQjNGLGlCQUFpQixTQVBuQyxXQUNFLE1BQU0sS0FBRWUsRUFBSSxJQUFFNkYsR0FBUVIsRUFBV08sY0FDakNkLEVBQWtCbkIsTUFBUTNELEVBQzFCK0UsRUFBd0JwQixNQUFRa0MsRUFDaEN1RCxFQUFxQmxLLGtCQUNyQndLLEVBQWMvRyxNQUNoQixJQUVBc0MsRUFBZWhHLGlCQUFpQixTQUFTLEtBQ3ZDa0ssRUFBaUJqSyxrQkFDakIwSyxFQUFhakgsTUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3IoZm9ybUVsZW1lbnQsIGNvbmZpZykge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBjb25maWcuaW5wdXRFcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBjb25maWcuZXJyb3JDbGFzcztcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9jaGVja0Zvcm1WYWxpZGl0eSA9ICgpID0+XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgY29uc3QgdmFsaWQgPSB0aGlzLl9jaGVja0Zvcm1WYWxpZGl0eSgpO1xuICAgIGlmICh2YWxpZCkge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vXG4gICAgLy8gY29uc3QgaXNWYWxpZCA9IHRoaXMuaW5wdXRFbGVtZW50cy5zb21lKChpbnB1dEVsZW1lbnQpPT4ge1xuICAgIC8vICAgICByZXR1cm4gaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkXG4gICAgLy8gfSlcbiAgICAvLyBpZiAoaXNWYWxpZCkge1xuICAgIC8vICAgICBzdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAvLyAgICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIHN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIC8vICAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAvLyAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gW1xuICAgICAgLi4udGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSxcbiAgICBdO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRFbGVtZW50cywgdGhpcy5fc3VibWl0QnV0dG9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnModGhpcy5fZm9ybUVsZW1lbnQpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIGRhdGEsXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZVByZXZpZXdJbWFnZSxcbiAgICBoYW5kbGVMaWtlQ2FyZCxcbiAgICBjdXJyZW50VXNlcklkLFxuICAgIGhhbmRsZURlbGV0ZUNhcmQsXG4gICAgb3duZXIsXG4gIH0pIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XG5cbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZVByZXZpZXdJbWFnZTtcbiAgICB0aGlzLl9oYW5kbGVMaWtlQ2FyZCA9IGhhbmRsZUxpa2VDYXJkO1xuICAgIHRoaXMuX2N1cnJlbnRVc2VySWQgPSBjdXJyZW50VXNlcklkO1xuICAgIHRoaXMuX293bmVyID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XG4gICAgY29uc29sZS5sb2codGhpcy5fb3duZXIpO1xuICB9XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LmZpcnN0RWxlbWVudENoaWxkLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gIH1cblxuICBkZWxldGVDbGljaygpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgdXBkYXRlTGlrZXMobGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzO1xuICAgIHRoaXMucmVuZGVyTGlrZXMoKTtcbiAgfVxuXG4gIHJlbmRlckxpa2VzKCkge1xuICAgIHRoaXMuX2NhcmRMaWtlcy50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICBjb25zdCBpc0xpa2VkID0gdGhpcy5pc0xpa2VkKCk7XG4gICAgaWYgKGlzTGlrZWQpIHtcbiAgICAgIHRoaXMubGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCk7XG4gIH1cblxuICBfY2hlY2tJZEZvckRlbGV0ZSgpIHtcbiAgICBpZiAodGhpcy5fb3duZXIgPT09IHRoaXMuX2N1cnJlbnRVc2VySWQpIHtcbiAgICAgIHRoaXMuYWRkVHJhc2goKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdmVUcmFzaCgpO1xuICAgIH1cbiAgfVxuXG4gIGFkZFRyYXNoKCkge1xuICAgIHRoaXMuY2FyZFRyYXNoQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX190cmFzaC1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgcmVtb3ZlVHJhc2goKSB7XG4gICAgdGhpcy5jYXJkVHJhc2hCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX3RyYXNoLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlTGlrZUNhcmQodGhpcy5pc0xpa2VkKCkpXG4gICAgKTtcbiAgICB0aGlzLmNhcmRUcmFzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzLl9pZCk7XG4gICAgfSk7XG4gICAgdGhpcy5jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICB0aGlzLmxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5jYXJkVHJhc2hCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdHJhc2gtYnV0dG9uXCIpO1xuICAgIHRoaXMuY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIGNvbnN0IGNhcmRUaXRsZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgICB0aGlzLmNhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuY2FyZEltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkTGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZXMtY291bnRlclwiKTtcbiAgICB0aGlzLnJlbmRlckxpa2VzKCk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9jaGVja0lkRm9yRGVsZXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwXCIpIHx8XG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX2Nsb3NlYnV0dG9uXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fbW9kYWxTYXZlQnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKTtcbiAgICB0aGlzLl9zYXZlQnV0dG9uVGV4dCA9IHRoaXMuX21vZGFsU2F2ZUJ1dHRvbi50ZXh0Q29udGVudDtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlKCkge1xuICAgIGNvbnN0IGlucHV0cyA9IHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcbiAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xuICAgIGlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWUoKSlcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9tb2RhbFNhdmVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9tb2RhbFNhdmVCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9zYXZlQnV0dG9uVGV4dDtcbiAgICB9XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcbiAgICBzdXBlci5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEZvcm07XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgc2VsZWN0b3IpIHtcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcygpIHtcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG59XG4iLCJjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUveW9zZW1pdGUuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQmFsZCBtb3VudGFpbnNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYXRlbWFyLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiLFxuICB9LFxuXTtcblxuY29uc3QgcHJvZmlsZU1vZGFsQm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb2RhbFwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVNb2RhbENsb3NlQnV0dG9uID1cbiAgcHJvZmlsZU1vZGFsQm94LnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWwtY2xvc2VidXR0b25cIik7XG5jb25zdCBwcm9maWxlRWRpdEZvcm0gPSBwcm9maWxlTW9kYWxCb3gucXVlcnlTZWxlY3RvcihcIiNtb2RhbC1mb3JtXCIpO1xuY29uc3QgcHJvZmlsZVRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLW5hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtZGVzY3JpcHRpb25cIik7XG5jb25zdCBhZGRNb2RhbEJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLXBvcHVwXCIpO1xuY29uc3QgYWRkTW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5jb25zb2xlLmxvZyhhZGRNb2RhbEJveCk7XG5jb25zdCBhZGRNb2RhbEZvcm0gPSBhZGRNb2RhbEJveC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1wb3B1cGZvcm1cIik7XG5jb25zdCBpbWFnZU1vZGFsV2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LXBvcHVwXCIpO1xuY29uc3QgaW1hZ2VDbG9zZUJ1dHRvbiA9IGltYWdlTW9kYWxXaW5kb3cucXVlcnlTZWxlY3RvcihcIiNwb3B1cC1jbG9zZWJ1dHRvblwiKTtcbmNvbnN0IGF2aUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2aS1wb3B1cGZvcm1cIik7XG5cbmNvbnN0IGZvcm1WYWxpZGF0aW9uQ29uZmlnID0ge1xuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCIsXG59O1xuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZU92ZXJsYXlDbG9zZShldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVFc2NVcChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlblBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XG4gICAgY2xvc2VNb2RhbChvcGVuUG9wdXApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVPdmVybGF5Q2xvc2UpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgaGFuZGxlRXNjVXApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGhhbmRsZU92ZXJsYXlDbG9zZSk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBoYW5kbGVFc2NVcCk7XG59XG5cbmV4cG9ydCB7XG4gIGZvcm1WYWxpZGF0aW9uQ29uZmlnLFxuICBpbWFnZUNsb3NlQnV0dG9uLFxuICBpbWFnZU1vZGFsV2luZG93LFxuICBhZGRNb2RhbEZvcm0sXG4gIGFkZE1vZGFsQnV0dG9uLFxuICBhZGRNb2RhbEJveCxcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQsXG4gIHByb2ZpbGVUaXRsZUlucHV0LFxuICBwcm9maWxlRWRpdEZvcm0sXG4gIHByb2ZpbGVNb2RhbENsb3NlQnV0dG9uLFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgcHJvZmlsZU1vZGFsQm94LFxuICBhdmlGb3JtLFxufTtcbiIsImltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgUG9wdXAgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXAuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvbi5qc1wiO1xuaW1wb3J0IHtcbiAgZm9ybVZhbGlkYXRpb25Db25maWcsXG4gIGltYWdlQ2xvc2VCdXR0b24sXG4gIGltYWdlTW9kYWxXaW5kb3csXG4gIGFkZE1vZGFsRm9ybSxcbiAgYWRkTW9kYWxCdXR0b24sXG4gIGFkZE1vZGFsQm94LFxuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCxcbiAgcHJvZmlsZVRpdGxlSW5wdXQsXG4gIHByb2ZpbGVFZGl0Rm9ybSxcbiAgcHJvZmlsZU1vZGFsQ2xvc2VCdXR0b24sXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxuICBwcm9maWxlTW9kYWxCb3gsXG4gIGF2aUZvcm0sXG59IGZyb20gXCIuLi91dGlscy91dGlscy5qc1wiO1xuXG5jb25zdCB1c2VySW5mb0VsID0gbmV3IFVzZXJJbmZvKHtcbiAgbmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxuICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgYXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2ltYWdlXCIsXG59KTtcblxuLyotLS0tLS0tLS0tIEFQSSAtLS0tLS0tLS0tKi9cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMTkyYTViNTctOWI2Mi00MTkyLTk2ZDYtMjE3ZDk5YjMzNTczXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcbmxldCBzZWN0aW9uRWw7XG5sZXQgY3VycmVudFVzZXJJZDtcbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmREYXRhXSkgPT4ge1xuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VyRGF0YS5faWQ7XG4gICAgdXNlckluZm9FbC5zZXRVc2VySW5mbyh7IG5hbWU6IHVzZXJEYXRhLm5hbWUsIGpvYjogdXNlckRhdGEuYWJvdXQgfSk7XG4gICAgdXNlckluZm9FbC5zZXRBdmF0YXJJbmZvKHVzZXJEYXRhLmF2YXRhcik7XG5cbiAgICBzZWN0aW9uRWwgPSBuZXcgU2VjdGlvbihcbiAgICAgIHtcbiAgICAgICAgaXRlbXM6IGNhcmREYXRhLFxuXG4gICAgICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVDYXJkKGRhdGEpO1xuICAgICAgICAgIHNlY3Rpb25FbC5hZGRJdGVtKGNhcmQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiLmNhcmRzX19saXN0XCJcbiAgICApO1xuICAgIHNlY3Rpb25FbC5yZW5kZXJJdGVtcygpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pO1xuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEpIHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKHtcbiAgICBkYXRhLFxuICAgIGNhcmRTZWxlY3RvcjogXCIjY2FyZC10ZW1wbGF0ZVwiLFxuICAgIGN1cnJlbnRVc2VySWQsXG4gICAgaGFuZGxlUHJldmlld0ltYWdlOiAoKSA9PiB7XG4gICAgICBpbWFnZVBvcHVwLm9wZW4oZGF0YSk7XG4gICAgfSxcbiAgICBoYW5kbGVMaWtlQ2FyZDogKHNob3VsZFJlbW92ZUxpa2UpID0+IHtcbiAgICAgIGlmIChzaG91bGRSZW1vdmVMaWtlKSB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5yZW1vdmVMaWtlKGRhdGEpXG4gICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXMoZGF0YS5saWtlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5hZGRMaWtlKGRhdGEpXG4gICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXMoZGF0YS5saWtlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhbmRsZURlbGV0ZUNhcmQ6IChjYXJkSWQpID0+IHtcbiAgICAgIGRlbGV0ZVBvcHVwLm9wZW4oKTtcbiAgICAgIGRlbGV0ZVBvcHVwLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XG4gICAgICAgIGRlbGV0ZVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5kZWxldGVDYXJkKGNhcmRJZClcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBjYXJkLmRlbGV0ZUNsaWNrKCk7XG4gICAgICAgICAgICBkZWxldGVQb3B1cC5jbG9zZSgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICBkZWxldGVQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbn1cblxuY29uc3QgYWRkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGFkZE1vZGFsRm9ybSwgZm9ybVZhbGlkYXRpb25Db25maWcpO1xuYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5jb25zb2xlLmxvZyhhZGRNb2RhbEZvcm0pO1xuXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBwcm9maWxlRWRpdEZvcm0sXG4gIGZvcm1WYWxpZGF0aW9uQ29uZmlnXG4pO1xucHJvZmlsZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhdmlGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoYXZpRm9ybSwgZm9ybVZhbGlkYXRpb25Db25maWcpO1xuYXZpRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGRlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcIiNkZWxldGUtcG9wdXBcIik7XG5kZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBlZGl0Rm9ybU1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjbW9kYWxcIiwgKGlucHV0VmFsdWVzKSA9PiB7XG4gIGVkaXRGb3JtTW9kYWwucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpXG4gICAgLmVkaXRQcm9maWxlKGlucHV0VmFsdWVzKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHVzZXJJbmZvRWwuc2V0VXNlckluZm8oe1xuICAgICAgICBuYW1lOiBpbnB1dFZhbHVlcy5uYW1lLFxuICAgICAgICBqb2I6IGlucHV0VmFsdWVzLmRlc2NyaXB0aW9uLFxuICAgICAgfSk7XG4gICAgICBlZGl0Rm9ybU1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGVkaXRGb3JtTW9kYWwucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG59KTtcbmVkaXRGb3JtTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgYWRkRm9ybU1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjYWRkLXBvcHVwXCIsIChpbnB1dFZhbHVlcykgPT4ge1xuICBhZGRGb3JtTW9kYWwucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpXG4gICAgLmFkZE5ld0NhcmQoaW5wdXRWYWx1ZXMpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVDYXJkKGRhdGEpO1xuICAgICAgc2VjdGlvbkVsLmFkZEl0ZW0oY2FyZCk7XG4gICAgICBhZGRGb3JtTW9kYWwuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYWRkRm9ybU1vZGFsLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xufSk7XG5hZGRGb3JtTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgdXBkYXRlUHJvZmlsZUZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNhdmktcG9wdXBcIiwgKGlucHV0VmFsdWVzKSA9PiB7XG4gIHVwZGF0ZVByb2ZpbGVGb3JtLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gIGFwaVxuICAgIC51cGRhdGVQcm9maWxlUGljdHVyZShpbnB1dFZhbHVlcylcbiAgICAudGhlbigodmFsdWUpID0+IHtcbiAgICAgIHVzZXJJbmZvRWwuc2V0QXZhdGFySW5mbyh2YWx1ZS5hdmF0YXIpO1xuICAgICAgdXBkYXRlUHJvZmlsZUZvcm0uY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgdXBkYXRlUHJvZmlsZUZvcm0ucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG59KTtcbnVwZGF0ZVByb2ZpbGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHByb2ZpbGVFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19pbWFnZVwiKTtcbnByb2ZpbGVFZGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHVwZGF0ZVByb2ZpbGVGb3JtLm9wZW4oKTtcbiAgYXZpRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbn0pO1xuXG5jb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI3ByZXZpZXctcG9wdXBcIik7XG5pbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIG9wZW5Qcm9maWxlTW9kYWwoKSB7XG4gIGNvbnN0IHsgbmFtZSwgam9iIH0gPSB1c2VySW5mb0VsLmdldFVzZXJJbmZvKCk7XG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gbmFtZTtcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBqb2I7XG4gIHByb2ZpbGVGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xuICBlZGl0Rm9ybU1vZGFsLm9wZW4oKTtcbn1cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvcGVuUHJvZmlsZU1vZGFsKTtcbmFkZE1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGFkZEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG4gIGFkZEZvcm1Nb2RhbC5vcGVuKCk7XG59KTtcblxuZnVuY3Rpb24gY2xvc2VQcm9maWxlTW9kYWwoKSB7XG4gIGVkaXRGb3JtTW9kYWwuY2xvc2UoKTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoeyBuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fbmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xuICAgIHRoaXMuX2pvYkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbC50ZXh0Q29udGVudCxcbiAgICAgIGpvYjogdGhpcy5fam9iRWwudGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVMZW1lbnQsXG4gICAgfTtcbiAgfVxuXG4gIHNldEF2YXRhckluZm8oYXZhdGFyKSB7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XG4gICAgdGhpcy5fbmFtZUVsLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB0aGlzLl9qb2JFbC50ZXh0Q29udGVudCA9IGpvYjtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuaW5pdGlhbENhcmRzKCldKTtcbiAgfVxuXG4gIGluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0UHJvZmlsZSh7IG5hbWUsIGRlc2NyaXB0aW9uIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGFib3V0OiBkZXNjcmlwdGlvbixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcInBvc3RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgY2FyZExpa2VzKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJRCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJRH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBhZGRMaWtlKHsgX2lkIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtfaWR9YCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgcmVtb3ZlTGlrZSh7IF9pZCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7X2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2ZpbGVQaWN0dXJlKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShhdmF0YXIpLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGVfX2J1dHRvblwiKTtcbiAgICB0aGlzLl9zYXZlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZVN1Ym1pdCgpO1xuICAgIH0pO1xuICB9XG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XG4gICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgdGhpcy5fY29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NvbmZpcm1CdXR0b24udGV4dENvbnRlbnQgPSBcInllc1wiO1xuICAgIH1cbiAgfVxuXG4gIHNldFN1Ym1pdEFjdGlvbihhY3Rpb24pIHtcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVTdWJtaXQgPSBhY3Rpb247XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9pbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtaW1hZ2VcIik7XG4gICAgdGhpcy5fdGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtdGV4dFwiKTtcbiAgfVxuXG4gIG9wZW4oeyBsaW5rLCBuYW1lIH0pIHtcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XG4gICAgdGhpcy5fdGV4dC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgc3VwZXIub3BlbigpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwiZm9ybUVsZW1lbnQiLCJjb25maWciLCJ0aGlzIiwiX2lucHV0RWxlbWVudHMiLCJldmVyeSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9mb3JtRWxlbWVudCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9jaGVja0Zvcm1WYWxpZGl0eSIsIl9zdWJtaXRCdXR0b24iLCJkaXNhYmxlZCIsIl9zZXRFdmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlc2V0VmFsaWRhdGlvbiIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIkNhcmQiLCJfcmVmIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZVByZXZpZXdJbWFnZSIsImhhbmRsZUxpa2VDYXJkIiwiY3VycmVudFVzZXJJZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJvd25lciIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9saWtlcyIsImxpa2VzIiwiX2lkIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZUxpa2VDYXJkIiwiX2N1cnJlbnRVc2VySWQiLCJfb3duZXIiLCJfaGFuZGxlRGVsZXRlQ2FyZCIsImNvbnNvbGUiLCJsb2ciLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImNsb25lTm9kZSIsImRlbGV0ZUNsaWNrIiwiX2VsZW1lbnQiLCJ1cGRhdGVMaWtlcyIsInJlbmRlckxpa2VzIiwiX2NhcmRMaWtlcyIsImxlbmd0aCIsImlzTGlrZWQiLCJsaWtlQnV0dG9uIiwic29tZSIsImxpa2UiLCJfY2hlY2tJZEZvckRlbGV0ZSIsImFkZFRyYXNoIiwicmVtb3ZlVHJhc2giLCJjYXJkVHJhc2hCdXR0b24iLCJjYXJkSW1hZ2UiLCJnZW5lcmF0ZUNhcmQiLCJjYXJkVGl0bGUiLCJzcmMiLCJhbHQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50IiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX3BvcHVwRm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX21vZGFsU2F2ZUJ1dHRvbiIsIl9zYXZlQnV0dG9uVGV4dCIsIl9nZXRJbnB1dFZhbHVlIiwiaW5wdXRzIiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJyZXNldCIsIlNlY3Rpb24iLCJzZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwicHJvZmlsZU1vZGFsQm94IiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlRWRpdEZvcm0iLCJwcm9maWxlVGl0bGVJbnB1dCIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwiYWRkTW9kYWxCb3giLCJhZGRNb2RhbEJ1dHRvbiIsImFkZE1vZGFsRm9ybSIsImF2aUZvcm0iLCJmb3JtVmFsaWRhdGlvbkNvbmZpZyIsInVzZXJJbmZvRWwiLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX25hbWVFbCIsIl9qb2JFbCIsIl9hdmF0YXJFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJqb2IiLCJhdmF0YXIiLCJfYXZhdGFyRUxlbWVudCIsInNldEF2YXRhckluZm8iLCJzZXRVc2VySW5mbyIsIl9yZWYyIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwiZ2V0QXBwSW5mbyIsImFsbCIsImluaXRpYWxDYXJkcyIsImVkaXRQcm9maWxlIiwiZGVzY3JpcHRpb24iLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFib3V0IiwiYWRkTmV3Q2FyZCIsIl9yZWYzIiwiY2FyZExpa2VzIiwiY2FyZElkIiwiZGVsZXRlQ2FyZCIsImNhcmRJRCIsImFkZExpa2UiLCJfcmVmNCIsInJlbW92ZUxpa2UiLCJfcmVmNSIsInVwZGF0ZVByb2ZpbGVQaWN0dXJlIiwiYXV0aG9yaXphdGlvbiIsInNlY3Rpb25FbCIsImNyZWF0ZUNhcmQiLCJjYXJkIiwiaW1hZ2VQb3B1cCIsInNob3VsZFJlbW92ZUxpa2UiLCJjYXRjaCIsImVyciIsImRlbGV0ZVBvcHVwIiwic2V0U3VibWl0QWN0aW9uIiwiZmluYWxseSIsInVzZXJEYXRhIiwiY2FyZERhdGEiLCJhZGRGb3JtVmFsaWRhdG9yIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJhdmlGb3JtVmFsaWRhdG9yIiwiX2NvbmZpcm1CdXR0b24iLCJfc2F2ZUJ1dHRvbiIsIl9oYW5kbGVEZWxldGVTdWJtaXQiLCJhY3Rpb24iLCJlZGl0Rm9ybU1vZGFsIiwiUG9wdXBXaXRoRm9ybSIsImFkZEZvcm1Nb2RhbCIsInVwZGF0ZVByb2ZpbGVGb3JtIiwiX2ltYWdlIiwiX3RleHQiXSwic291cmNlUm9vdCI6IiJ9